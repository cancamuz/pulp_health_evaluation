<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pulpabefund Formular</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
    h2 { margin-top: 30px; }
    label { margin-top: 5px; }
    input[type="checkbox"], input[type="radio"] { margin-right: 5px; }
    input[type="text"] { width: 100%; padding: 5px; margin-top: 5px; }
    .section { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
    button { margin-top: 20px; padding: 10px 20px; }
    .slider-container { display: flex; align-items: center; gap: 10px; }
    .slider { flex: 1; -webkit-appearance: none; height: 15px; border-radius: 7px; background: linear-gradient(to right, green, yellow, red); outline: none; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #333; cursor: pointer; }
    .slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: #333; cursor: pointer; }

    .inline-group { margin-top: 10px; }
    .inline-group span { margin-right: 10px; font-weight: bold; }
    .inline-group label { margin-right: 15px; display: inline-block; }

    .pain-type-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
    .pain-type-group label { display: flex; align-items: center; }

    .pain-intensity-label { display: block; margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Pulpabefund Formular</h1>

  <form id="pulpForm">
    <div class="section">
      <h2>Patientendaten</h2>
      <label>Studien-ID des Patienten <input type="text" id="patientID" required></label>
      <label>Geburtsjahr <input type="text" id="yearOfBirth" placeholder="z.B. 1985" required></label>

      <div class="inline-group">
        <span>Geschlecht:</span>
        <label><input type="radio" name="sex" value="Männlich" required>Männlich</label>
        <label><input type="radio" name="sex" value="Weiblich">Weiblich</label>
      </div>

      <div class="inline-group">
        <span>Rauchen:</span>
        <label><input type="radio" name="smoking" value="Ja" required>Ja</label>
        <label><input type="radio" name="smoking" value="Nein">Nein</label>
      </div>

      <div class="inline-group">
        <span>Antibiotika (letzte 24h):</span>
        <label><input type="radio" name="antibiotics" value="Ja" required>Ja</label>
        <label><input type="radio" name="antibiotics" value="Nein">Nein</label>
      </div>

      <div class="inline-group">
        <span>Schmerzmittel (letzte 24h):</span>
        <label><input type="radio" name="painkillers" value="Ja" required>Ja</label>
        <label><input type="radio" name="painkillers" value="Nein">Nein</label>
        <input type="text" name="painkillerType" placeholder="Falls ja, welches?">
      </div>
    </div>

    <div class="section">
      <h2>Schmerztyp (Patientenangabe - alles Zutreffende ankreuzen)</h2>
      <div class="pain-type-group">
        <label><input type="checkbox" name="painType" value="Kein Schmerz">Kein Schmerz</label>
        <label><input type="checkbox" name="painType" value="Provoziert (durch Reiz, Hitze, Süßes...)">Provoziert</label>
        <label><input type="checkbox" name="painType" value="Spontan">Spontan</label>
        <label><input type="checkbox" name="painType" value="Stechend">Stechend</label>
        <label><input type="checkbox" name="painType" value="Dumpf">Dumpf</label>
        <label><input type="checkbox" name="painType" value="Pulsierend">Pulsierend</label>
        <label><input type="checkbox" name="painType" value="Ausstrahlend">Ausstrahlend</label>
        <label><input type="checkbox" name="painType" value="Kurzzeitig">Kurzzeitig</label>
        <label><input type="checkbox" name="painType" value="Langanhaltend">Langanhaltend</label>
      </div>
      <label class="pain-intensity-label">Schmerzintensität (0 = kein Schmerz, 10 = stärkster Schmerz)</label>
      <div class="slider-container">
        <input type="range" id="painIntensity" class="slider" min="0" max="10" step="1" value="0" oninput="document.getElementById('painVal').textContent=this.value">
        <span id="painVal">0</span>
      </div>
    </div>

    <div class="section">
      <h2>Kältetest (15 Sekunden CO2-Anwendung)</h2>
      <div class="inline-group">
        <span>Reaktion:</span>
        <label><input type="radio" name="coldReaction" value="Keine Sensibilität / keine Reaktion" required>Keine Sensibilität / keine Reaktion</label>
        <label><input type="radio" name="coldReaction" value="Sensibilität vorhanden / positive Reaktion">Sensibilität vorhanden / positive Reaktion</label>
      </div>
      <label class="pain-intensity-label">Schmerzintensität (0 = kein Schmerz, 10 = stärkster Schmerz)</label>
      <div class="slider-container">
        <input type="range" id="coldIntensity" class="slider" min="0" max="10" step="1" value="0" oninput="document.getElementById('coldVal').textContent=this.value">
        <span id="coldVal">0</span>
      </div>
      <div class="inline-group">
        <span>Dauer des Schmerzes nach der Reizentfernung:</span>
        <label><input type="radio" name="coldDuration" value="0 - 3 Sekunden" required>0-3s</label>
        <label><input type="radio" name="coldDuration" value="4 - 8 Sekunden">4-8s</label>
        <label><input type="radio" name="coldDuration" value="9 - 15 Sekunden">9-15s</label>
        <label><input type="radio" name="coldDuration" value="16 - 30 Sekunden">16-30s</label>
        <label><input type="radio" name="coldDuration" value="> 30 Sekunden">&gt;30s</label>
      </div>
    </div>

    <div class="section">
      <h2>Perkussion</h2>
      <div class="inline-group">
        <span>Laterale Perkussion:</span>
        <label><input type="radio" name="percussionLateral" value="Nicht klopfdolent / keine Reaktion" required>Nicht klopfdolent / keine Reaktion</label>
        <label><input type="radio" name="percussionLateral" value="Klopfdolent / positive Reaktion">Klopfdolent / positive Reaktion</label>
      </div>
      <label class="pain-intensity-label">Schmerzintensität</label>
      <div class="slider-container">
        <input type="range" id="latPercIntensity" class="slider" min="0" max="10" step="1" value="0" oninput="document.getElementById('latPercVal').textContent=this.value">
        <span id="latPercVal">0</span>
      </div>

      <div class="inline-group">
        <span>Vertikale Perkussion:</span>
        <label><input type="radio" name="percussionVertical" value="Nicht klopfdolent / keine Reaktion" required>Nicht klopfdolent / keine Reaktion</label>
        <label><input type="radio" name="percussionVertical" value="Klopfdolent / positive Reaktion">Klopfdolent / positive Reaktion</label>
      </div>
      <label class="pain-intensity-label">Schmerzintensität</label>
      <div class="slider-container">
        <input type="range" id="vertPercIntensity" class="slider" min="0" max="10" step="1" value="0" oninput="document.getElementById('vertPercVal').textContent=this.value">
        <span id="vertPercVal">0</span>
      </div>
    </div>

    <div class="section">
      <h2>Palpation</h2>
      <div class="inline-group">
        <span>Palpation:</span>
        <label><input type="radio" name="palpation" value="Nicht klopfdolent / keine Reaktion" required>Nicht klopfdolent / keine Reaktion</label>
        <label><input type="radio" name="palpation" value="Klopfdolent / positive Reaktion">Klopfdolent / positive Reaktion</label>
      </div>
      <label class="pain-intensity-label">Schmerzintensität</label>
      <div class="slider-container">
        <input type="range" id="palpationIntensity" class="slider" min="0" max="10" step="1" value="0" oninput="document.getElementById('palpVal').textContent=this.value">
        <span id="palpVal">0</span>
      </div>
    </div>

    <div class="section">
      <h2>Pulpaexposition</h2>
      <div class="inline-group">
        <span>Pulpa freigelegt:</span>
        <label><input type="radio" name="pulpExposure" value="Nein" required>Nein</label>
        <label><input type="radio" name="pulpExposure" value="Ja">Ja</label>
      </div>
    </div>

    <div class="section">
      <h2>Quadrant (in dem der Schmerz ist)</h2>
      <div class="inline-group">
        <span>Quadrant:</span>
        <label><input type="checkbox" name="quadrant" value="Q1" required>Q1</label>
        <label><input type="checkbox" name="quadrant" value="Q2" required>Q2</label>
        <label><input type="checkbox" name="quadrant" value="Q3" required>Q3</label>
        <label><input type="checkbox" name="quadrant" value="Q4" required>Q4</label>
      </div>
      <div class="inline-group">
        <span>Gab es in der Vergangenheit Schmerzen im selben Quadranten?:</span>
        <label><input type="radio" name="geschichte" value="Nein" required>Nein</label>
        <label><input type="radio" name="geschichte" value="Ja">Ja</label>
    </div>

    <div class="section">
      <h2>Klinische Ersteinschätzung (alles Zutreffende ankreuzen)</h2>
      <div class="inline-group">
        <span>Befund:</span>
        <label><input type="checkbox" name="impression" value="Normale Pulpa" required>Normale Pulpa</label>
        <label><input type="checkbox" name="impression" value="Reversible Pulpitis">Reversible Pulpitis</label>
        <label><input type="checkbox" name="impression" value="Irreversible Pulpitis">Irreversible Pulpitis</label>
        <label><input type="checkbox" name="impression" value="Parodontitis">Parodontitis</label>
        <label><input type="checkbox" name="impression" value="Periapikaler Abszess">Periapikaler Abszess</label>
        <label><input type="checkbox" name="impression" value="Nekrotische Pulpa">Nekrotische Pulpa</label>
        <label><input type="checkbox" name="impression" value="Sinusitis/nicht-zahnärztliche Infektion">Sinusitis/nicht-zahnärztliche Infektion</label>
      </div>
    </div>

    <button type="button" onclick="saveData()">Eintrag speichern</button>
    <button type="button" onclick="downloadCSV()">CSV exportieren</button>
  </form>

  <script>
    let records = [];

    function saveData() {
      const painTypeChecks = document.querySelectorAll('input[name="painType"]:checked');
      const painTypeValues = Array.from(painTypeChecks).map(cb => cb.value).join("; ");

      const record = {
        patientID: document.getElementById('patientID').value,
        yearOfBirth: document.getElementById('yearOfBirth').value,
        sex: document.querySelector('input[name="sex"]:checked')?.value || "",
        antibiotics: document.querySelector('input[name="antibiotics"]:checked')?.value || "",
        painkillers: document.querySelector('input[name="painkillers"]:checked')?.value || "",
        painType: painTypeValues,
        painIntensityVAS: document.getElementById('painIntensity').value,
        coldReaction: document.querySelector('input[name="coldReaction"]:checked')?.value || "",
        coldIntensity: document.getElementById('coldIntensity').value,
        coldDuration: document.querySelector('input[name="coldDuration"]:checked')?.value || "",
        percussionLateral: document.querySelector('input[name="percussionLateral"]:checked')?.value || "",
        latPercIntensity: document.getElementById('latPercIntensity').value,
        percussionVertical: document.querySelector('input[name="percussionVertical"]:checked')?.value || "",
        vertPercIntensity: document.getElementById('vertPercIntensity').value,
        palpation: document.querySelector('input[name="palpation"]:checked')?.value || "",
        palpationIntensity: document.getElementById('palpationIntensity').value,
        pulpExposure: document.querySelector('input[name="pulpExposure"]:checked')?.value || "",
        impression: document.querySelector('input[name="impression"]:checked')?.value || ""
      };
      records.push(record);
      alert("Eintrag gespeichert!");
      document.getElementById('pulpForm').reset();
      document.getElementById('painVal').textContent = 0;
      document.getElementById('coldVal').textContent = 0;
      document.getElementById('latPercVal').textContent = 0;
      document.getElementById('vertPercVal').textContent = 0;
      document.getElementById('palpVal').textContent = 0;
    }

    function csvEscape(value) {
      if (value == null) return "";
      const v = String(value).replace(/"/g, '""');
      return `"${v}"`;
    }

    function downloadCSV() {
      let csv = "PatientID,Geburtsjahr,Geschlecht,Antibiotika,Schmerzmittel,Schmerztyp,VAS_Schmerz,Kältetest_Reaktion,VAS_Kälte,Schmerzdauer,Laterale_Perkussion,VAS_Lateral,Vertikale_Perkussion,VAS_Vertikal,Palpation,VAS_Palpation,Pulpaexposition,Befund\n";
      records.forEach(r => {
        csv += [
          r.patientID, r.yearOfBirth, r.sex, r.antibiotics, r.painkillers,
          r.painType, r.painIntensityVAS, r.coldReaction, r.coldIntensity,
          r.coldDuration, r.percussionLateral, r.latPercIntensity,
          r.percussionVertical, r.vertPercIntensity, r.palpation,
          r.palpationIntensity, r.pulpExposure, r.impression
        ].map(csvEscape).join(",") + "\n";
      });
      const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.setAttribute('hidden', '');
      a.setAttribute('href', url);
      a.setAttribute('download', 'pulpabefund.csv');
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>

</body>
</html>
